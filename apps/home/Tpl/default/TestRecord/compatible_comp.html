<include file="__THEME__/header" />
<style type="text/css">
    .col-md-6 {height: 40px;}
</style>
<script src="__PUBLIC__/js/echarts2.2.7/build/dist/echarts-all.js"></script>
<div class="center record">
    <h2 class="gray"><a href="{:U('home/Index/index')}">首页</a>><a href="{:U('home/Account/index')}">用户信息管理</a>><a href="{:U('home/TestRecord/index')}">测试记录</a>><span class="blue">{$business_title|getBusinessTitle}</span></h2>
    <div class="left">
        <include file="_compatible_menu" />
    </div>
    <div class="right">
   <include file="../Account/_menu" />
   <h4 class="row">
       <div class="col-md-5">兼容概况</div>
       <include file="_share_menu" />
   </h4>
        <div class="compatible_basic">
            <div class="row">
                <div class="col-md-4 noteYunTh2" id="noteYunTh2" style="width:290px;height:180px"></div>
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-2 lightgreenBg space"> </div>
                        <div class="col-md-9">
                            <div class="col-md-6 lightblueBg">测试结果</div>
                            <div class="col-md-6 lightblueBg">终端数（款）</div>
                        </div>
                        <div class="col-md-2 lightgreenBg" style="height:118px;line-height:118px;">通过概况</div>
                        <div class="col-md-9">
                            <div class="col-md-6 lightgreenBg">待优化</div>
                            <div class="col-md-6 lightgreenBg">{$vo['optimize_num']}</div>
                            <div class="col-md-6 lightgreenBg">成功</div>
                            <div class="col-md-6 lightgreenBg">{$vo['success_num']}</div>
                            <div class="col-md-6 lightgreenBg">通过合计</div>
                            <div class="col-md-6 lightgreenBg" id="through_num">{$vo['optimize_num']+$vo['success_num']}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 noteYunTh2" id="noteYunTh3" style="width:290px;height:300px;"></div>
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-2 lightgreenBg space"> </div>
                        <div class="col-md-9">
                            <div class="col-md-6 lightblueBg">测试结果</div>
                            <div class="col-md-6 lightblueBg">终端数（款）</div>
                        </div>
                        <div class="col-md-2 lightgreenBg" style="height:235px;line-height:235px;">不兼容概况</div>
                        <div class="col-md-9">
                            <div class="col-md-6 lightgreenBg">安装失败</div>
                            <div class="col-md-6 lightgreenBg">{$vo['install_failed_num']}</div>
                            <div class="col-md-6 lightgreenBg">运行失败</div>
                            <div class="col-md-6 lightgreenBg">{$vo['run_failed_num']}</div>
                            <div class="col-md-6 lightgreenBg">启动失败</div>
                            <div class="col-md-6 lightgreenBg">{$vo['boot_failed_num']}</div>
                            <div class="col-md-6 lightgreenBg">功能异常</div>
                            <div class="col-md-6 lightgreenBg">{$vo['func_exception_num']}</div>
                            <div class="col-md-6 lightgreenBg">UI异常</div>
                            <div class="col-md-6 lightgreenBg">{$vo['ui_exception_num']}</div>
                            <div class="col-md-6 lightgreenBg">不兼容合计</div>
                            <div class="col-md-6 lightgreenBg" id="incomp_num">{$vo['install_failed_num']+$vo['run_failed_num']+$vo['boot_failed_num']+$vo['func_exception_num']+$vo['ui_exception_num']}</div>
                        </div>
                    </div>
                </div>
            </div>
<!--            <div class="row">
                <div class="col-md-4 noteYunTh2" id="noteYunTh4" style="width:290px;height:300px;">  </div>
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-2 lightgreenBg space"> </div>
                        <div class="col-md-9">
                            <div class="col-md-6 lightblueBg">测试结果</div>
                            <div class="col-md-6 lightblueBg">终端数（款）</div>
                        </div>
                        <div class="col-md-2 lightgreenBg" style="height:235px;line-height:235px;">问题类型分布</div>
                        <div class="col-md-9">
                            <div class="col-md-6 lightgreenBg">安装失败</div>
                            <div class="col-md-6 lightgreenBg">{$vo['install_failed_num']}</div>
                            <div class="col-md-6 lightgreenBg">运行失败</div>
                            <div class="col-md-6 lightgreenBg">{$vo['run_failed_num']}</div>
                            <div class="col-md-6 lightgreenBg">待优化</div>
                            <div class="col-md-6 lightgreenBg">{$vo['optimize_num']}</div>
                            <div class="col-md-6 lightgreenBg">启动失败</div>
                            <div class="col-md-6 lightgreenBg">{$vo['boot_failed_num']}</div>
                            <div class="col-md-6 lightgreenBg">功能异常</div>
                            <div class="col-md-6 lightgreenBg">{$vo['func_exception_num']}</div>
                            <div class="col-md-6 lightgreenBg">UI异常</div>
                            <div class="col-md-6 lightgreenBg">{$vo['ui_exception_num']}</div>
                        </div>
                    </div>
                </div>
            </div>-->
        </div>
        <div class="kite"><img src="__THEME__/images/kite.png"/></div>
    </div>
</div>
<div style="clear: both;"></div>
<php>
    $noteYunTh2TT            = $vo['optimize_num'] + $vo['success_num'];
    $i = 0;
    $noteYunTh2[$i]['value'] = $vo['optimize_num'];
    $noteYunTh2[$i]['name']  = '待优化 '.sprintf("%.0f", $vo['optimize_num']/$noteYunTh2TT*100) . '%';
    $i ++;
    $noteYunTh2[$i]['value'] = $vo['success_num'];
    $noteYunTh2[$i]['name']  = '成功 '.sprintf("%.0f", $vo['success_num']/$noteYunTh2TT*100) . '%';

    $tt2 =  array(
        '安装失败' => $vo['install_failed_num'],
        '运行失败' => $vo['run_failed_num'],
        '启动失败' => $vo['boot_failed_num'],
        '功能异常' => $vo['func_exception_num'],
        'UI异常'   => $vo['ui_exception_num'],
    );
    function formatEchart($tt2) {
        $noteYunTh3TT = array_sum($tt2);
        $noteYunTh3   = array();
        $i = 0;
        foreach($tt2 as $key => $_one) {
            $noteYunTh3[$i]['value'] = $_one;
            $noteYunTh3[$i]['name']  = $key .sprintf("%.0f", $_one/$noteYunTh3TT*100) . '%';
            $i ++;
        }
        return $noteYunTh3;
    }
    $noteYunTh3 = formatEchart($tt2);
   // $tt3 =  array(
    ///    '安装失败' => $vo['install_failed_num'],
     //   '运行失败' => $vo['run_failed_num'],
       // '待优化'  => $vo['optimize_num'],
     //   '启动失败' => $vo['boot_failed_num'],
    //    '功能异常' => $vo['func_exception_num'],
     //   'UI异常' => $vo['ui_exception_num'],
   // );
  //  $noteYunTh4 = formatEchart($tt3);
</php>
<script type="text/javascript">
function getOption(data) {
    var option = {
        tooltip : {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
        },
        legend: {
            orient : 'vertical',
            x : '60%',
            y : 'center',
            selectedMode:false,
            data:data
        },
        calculable : false,
        series : [
            {
                name:'测试结果',
                type:'pie',
                radius : [40, 60],
                
                // for funnel
                x: '60%',
                width: '35%',
                center : ['35%', '50%'],
                funnelAlign: 'left',
                itemStyle :　{
                    normal : {
                        label : {
                            show : false
                        },
                        labelLine : {
                            show : false
                        }
                    }
                }, 
                data:data
            }
        ]
    };

    return option;
}
// 基于准备好的dom，初始化echarts图表
var i=document.getElementById('through_num').innerHTML;
if(i!=0){
var noteYunTh2     = echarts.init(document.getElementById('noteYunTh2'));
var noteYunTh2Data = <?php echo json_encode($noteYunTh2); ?>;
noteYunTh2.setOption(getOption(noteYunTh2Data));}
var j=document.getElementById('incomp_num').innerHTML;
if(j!=0){
var noteYunTh3     = echarts.init(document.getElementById('noteYunTh3'));
var noteYunTh3Data = <?php echo json_encode($noteYunTh3); ?>;
noteYunTh3.setOption(getOption(noteYunTh3Data));}
//var noteYunTh4     = echarts.init(document.getElementById('noteYunTh4'));
//var noteYunTh4Data = <?php echo json_encode($noteYunTh4); ?>;
//noteYunTh4.setOption(getOption(noteYunTh4Data));
</script>
<include file="__THEME__/footer" />
